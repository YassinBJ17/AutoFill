#include "LIBUTI_SIF_iterators.h"
#include "LIBUTI_SIF_getters.h"
#include "LIBUTI_SIF_getters_from_headers.h"
#include "LIBUTI_SIF_get_next_file_skip.h"
#include "BOOT_LIBMEM_public.h"

 TE_LIBUTI_SIF_status LIBUTI_SIF_get_next_file( ts_LIBUTI_SIF_file_info * const file, ts_LIBUTI_SIF_iterator * const iter ) {    uint32_t next_ptr;    TE_LIBUTI_SIF_status ret;    uint32_t name_ptr, nb_global_chk_ptr, nb_datapacket_chk_ptr;    ret = E_LIBUTI_SIF_FAILURE;    nb_global_chk_ptr = (uint32_t)0;    nb_datapacket_chk_ptr = (uint32_t)0;    if ( iter->data.position < iter->data.header_length )    {       BOOT_LIBMEM_SET((uint8_t *)file, 0, sizeof(ts_LIBUTI_SIF_file_info));       next_ptr = LIBUTI_SIF_get_long(&(iter->data));       iter->item_count--;       if ( ( next_ptr == (uint32_t)0 ) || ( iter->item_count == (uint16_t)0 ) )       {          next_ptr = iter->data.header_length;       }       else       {          next_ptr += iter->data.position - (uint32_t)4;       }       if (iter->format_version >= (uint16_t)0xB002)       {          name_ptr = LIBUTI_SIF_get_long(&(iter->data));          name_ptr += iter->data.position - (uint32_t)4;          nb_global_chk_ptr = LIBUTI_SIF_get_long(&(iter->data));          if (nb_global_chk_ptr != (uint32_t)0)          {             nb_global_chk_ptr += iter->data.position - (uint32_t)4;          }          nb_datapacket_chk_ptr = LIBUTI_SIF_get_long(&(iter->data));          if (nb_datapacket_chk_ptr != (uint32_t)0)          {             nb_datapacket_chk_ptr += iter->data.position - (uint32_t)4;          }          iter->data.position = name_ptr;       }       LIBUTI_SIF_get_strl(&(iter->data), &(file->Name));       file->file_length = LIBUTI_SIF_get_long(&(iter->data));       if (iter->format_version >= (uint16_t)0xB002)       {          iter->data.position = nb_global_chk_ptr;       }       LIBUTI_SIF_get_next_file_skip( file, iter );       if (iter->format_version >= (uint16_t)0xB002)       {          iter->data.position = nb_datapacket_chk_ptr;       }       if (iter->data.position != (uint32_t)0)       {          file->packet_check_number = LIBUTI_SIF_get_short(&(iter->data));          file->first_packet_check_addr = iter->data.position;       }       if ( iter->data.position < iter->data.header_length )       {          ret = E_LIBUTI_SIF_SUCCESS;          iter->data.position = next_ptr;       }       else       {          iter->data.position = iter->data.header_length;       }    }    return ( ret ); }
